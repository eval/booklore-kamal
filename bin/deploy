#!/usr/bin/env bash
set -e

cd "$(dirname "$0")/.."

# Get version: use argument, or fetch latest release
if [ -n "$1" ]; then
  VERSION="$1"
else
  echo "Fetching latest BookLore release..."
  VERSION=$(gh release list --repo booklore-app/booklore --limit 1 --json tagName -q '.[0].tagName')
fi

if [ -z "$VERSION" ]; then
  echo "Error: Could not determine version to deploy"
  exit 1
fi

echo "Deploying BookLore $VERSION"
export VERSION
mise exec -- bin/kamal deploy
